#include "GlobalGame.h"
GlobalGame* GlobalGame::m_GlobalGame = nullptr;
void GlobalGame::InitGame()
{

	//GlobalGame* game = GetInstance();

	//vector<ULONG_PTR>* v = game->GetGameData();

	//DataQuery* o = game->GetDataQuery();
	//ULONG_PTR val = o->GetBeiBaoJiZi();
	//(*v)[BeiBaoJizhi] = val;


	//ULONG val2 = searchCode("xajh.exe", ".text", "81FBFC0300007509BE04000000EB0233F68B55088D4C242C5156528BC8E8????????8BD885DB", 0x1d + 1);
	//(*v)[获取背包物品数据结构CALL] = val2;


	//DebugPrint("[icxl]:%p,%p", v[BeiBaoJizhi], v[获取背包物品数据结构CALL]);









	GlobalGame* game = GetInstance();



	DataQuery* o = game->GetDataQuery();
	ULONG_PTR val = o->GetBeiBaoJiZi();
	*game->GetGameData(BeiBaoJizhi) = val;


	val = searchCode("xajh.exe", ".text", "81FBFC0300007509BE04000000EB0233F68B55088D4C242C5156528BC8E8????????8BD885DB", 0x1d);
	*game->GetGameData(获取背包物品数据结构CALL) = game->CalcCallPos(val);


	val = searchCode("xajh.exe", ".text", "0F8C????????8B7D108B073970??0F84????????8B0D????????E8????????8974242C81FBEB030000750A", 0x14 + 2);
	*game->GetGameData(获取背包物品数据结构CALLthis基址) = game->GetMemoryOp()->ReadMemory<ULONG_PTR>(val);

	val = searchCode("xajh.exe", ".text", "CCA1????????85C0740B8B40??85C074048B40??C333C0C3CC", 2);
	*game->GetGameData(获取NPCthis基质) = game->GetMemoryOp()->ReadMemory<ULONG_PTR>(val);

	val = searchCode("xajh.exe", ".text", "8B018B90????????FFE2C3CC81E9B4000000E9????????CCCCCCCCCC8B81????????C3CC", 0x1c);
	*game->GetGameData(获取NPCNameCall) = val;

	val = searchCode("xajh.exe", ".text", "A3????????A3????????A3????????A3????????A3????????A3????????A3????????A3????????B9????????E8????????84C0", 0x29);
	*game->GetGameData(获取攻击this基质) = game->GetMemoryOp()->ReadMemory<ULONG_PTR>(val);

	val = searchCode("xajh.exe", ".text", "83EC5453558B6C2474568BF1578974241485ED750C32C05F5E5D5B83C454C218008B45008B90????????8BCDFFD284C074E3", 0);
	*game->GetGameData(获取gj私有代码Call) = val;

	val = searchCode("xajh.exe", ".text", "CCCCCCA1????????85C0740E8B40??85C074078B80????????C333C0C3CCCCCCCC", 3);
	*game->GetGameData(获取自己基质CALL) = val;

	val = searchCode("xajh.exe", ".text", "C204008B4424248B4E??6A016A006A016A006A006A006A008D54242C528B56??5052", 0x59);
	*game->GetGameData(获取技能CALL) = game->CalcCallPos(val);
	val = searchCode("xajh.exe", ".text", "751E8B7F??8B9F????????8BBF????????E8????????5753E8????????83C408F605????????04", 0x18);
	*game->GetGameData(获取选中怪物CALL) = game->CalcCallPos(val);
	val = searchCode("xajh.exe", ".text", "CCA1????????85C0740E8B40??85C074078B80????????C333C0C3CC", 1);
	*game->GetGameData(获取人物基质ThisCall) = val;

	val = searchCode("xajh.exe", ".text", "5F5E5D5B8BE55DC3E8????????8B80????????8B0D????????8B89????????50E8????????3BC574C08DB8????????", 0x13 + 2);
	*game->GetGameData(获取GetJNFLIDs) = GlobalGame::GetInstance()->GetMemoryOp()->ReadMemory<ULONG_PTR>(val);

	val = searchCode("xajh.exe", ".text", "5F5E5D5B8BE55DC3E8????????8B80????????8B0D????????8B89????????50E8????????3BC574C08DB8????????", 0x20);
	*game->GetGameData(获取GetJNFLIDCall) = game->CalcCallPos(val);


	val = searchCode("xajh.exe", ".text", "53555657518BE98BCC8964244068????????896C242CE8????????8BCDE8????????8B0D????????8BF8", 0x24);
	*game->GetGameData(获取GetJNFLDetail1) = GlobalGame::GetInstance()->GetMemoryOp()->ReadMemory<ULONG_PTR>(val);

	val = searchCode("xajh.exe", ".text", "53555657518BE98BCC8964244068????????896C242CE8????????8BCDE8????????8B0D????????8BF8", 0x2A);
	*game->GetGameData(获取GetJNFLDetailCall) = game->CalcCallPos(val);

	val = searchCode("xajh.exe", ".text", "53555657518BE98BCC8964244068????????896C242CE8????????8BCDE8????????8B0D????????8BF8", 0x39);
	*game->GetGameData(获取GetJNFLDetailCall2) = game->CalcCallPos(val);

	val = searchCode("xajh.exe", ".text", "53555657518BE98BCC8964244068????????896C242CE8????????8BCDE8????????8B0D????????8BF8", 0x85);
	*game->GetGameData(获取GetJNDetailCall1) = game->CalcCallPos(val);

	val = searchCode("xajh.exe", ".text", "53555657518BE98BCC8964244068????????896C242CE8????????8BCDE8????????8B0D????????8BF8", 0xbf);
	*game->GetGameData(获取GetJNDetailCall2) = game->CalcCallPos(val);


	val = searchCode("xajh.exe", ".text", "0F84????????807B??FF0F94C20FB6C2505555E8????????85C00F84????????E8????????", 0x20);
	*game->GetGameData(获取人物偏移90Call) = game->CalcCallPos(val);

	val = searchCode("xajh.exe", ".text", "74158B44244850E8????????83C40485C07404894424488B4C2448518B4C2418E8????????", 0x20);
	*game->GetGameData(获取技能信息Call) = game->CalcCallPos(val);

	val = searchCode("xajh.exe", ".text", "751B8B550880BA????????00740F5D5E5FB8100000005B83C414C24C008BCBE8????????", 0x1f);
	*game->GetGameData(根据技能信息获取冷却Call) = game->CalcCallPos(val);
	//DebugPrint("[icxl]:%p,%p,%p", *game->GetGameData(BeiBaoJizhi), *game->GetGameData(获取背包物品数据结构CALL), *game->GetGameData(获取背包物品数据结构CALLthis基址));

	val = searchCode("xajh.exe", ".text", "8B4C241452505553E8????????EB188B8C24B40000008B9424B00000005152E8????????", 0x1f);
	*game->GetGameData(获取吃药call) = game->CalcCallPos(val);
	

	val = searchCode("xajh.exe", ".text", "A1????????85C074048B40??C333C0C3A1????????85C0740B8B40??85C074048B40??C333C0C3", 0);
	*game->GetGameData(获取捡物品基质call) = val;

	val = searchCode("xajh.exe", ".text", "8B44240C8B542408508B442408525081C128020000E8????????C20C00", 0);
	*game->GetGameData(获取捡物品call) = val;

	val = searchCode("xajh.exe", ".text", "8B48??528B108B40??518B8DB40200005250EB2DE8????????D905????????8B96????????6A00", 0x14);
	*game->GetGameData(获取自动寻路基质call) = game->CalcCallPos(val);

	val = searchCode("xajh.exe", ".text", "8B48??528B108B40??518B8DB40200005250EB2DE8????????D905????????8B96????????6A00", 0x43);
	*game->GetGameData(获取自动寻路call) = game->CalcCallPos(val);


}



DWORD GlobalGame::GetVirualFunc(DWORD nEcx, DWORD pianyi)
{
	DWORD nthis = GetMemoryOp()->ReadMemory<DWORD>(nEcx);

	return GetMemoryOp()->ReadMemory<DWORD>(nthis + pianyi);
}
